# System Dependencies Configuration
# This file documents the system dependencies required for development and testing.
# CI and local setup scripts should reference this file to ensure version consistency.
#
# Version pinning strategy:
# - ALWAYS pin specific versions (e.g., "1.2.3") - NEVER use "latest"
# - For Ubuntu: versions are Ubuntu release-specific (check with: apt-cache policy <package>)
# - For macOS: Homebrew versions can be pinned using @version syntax
# - For Windows: Chocolatey supports --version flag
# - All dependencies MUST have pinned versions for reproducibility

[ubuntu]
# Ubuntu package versions (install via apt-get)
# Format: "package=version" for pinned versions (fails if not available, no fallback)
# To check available versions: apt-cache policy <package> or apt-cache madison <package>
# Note: Exact versions depend on Ubuntu release. CI uses a pinned Ubuntu version for consistency.
# Version format example: "7:7.1.0-1ubuntu2" (epoch:version-release)
# IMPORTANT: Verify these versions match what's available in the pinned Ubuntu CI version:
#   Run in CI: apt-cache madison <package> to see available versions
#   Update these pinned versions to match what CI actually installs
ffmpeg = "7:6.1.1-3ubuntu5"
flac = "1.4.3+ds-2.1ubuntu2"
mediainfo = "24.01.1-1build2"
id3v2 = "0.1.12+dfsg-7"
libimage-exiftool-perl = "12.76+dfsg-1"
# libsndfile1: Library dependency (not executable tool) required by soundfile Python package.
# Uses "latest" because: (1) it's a transitive dependency managed by Ubuntu's package manager,
# (2) it doesn't have a version command to verify, (3) version is tied to Ubuntu release and
# Ubuntu provides compatible versions automatically. This is an exception to the version pinning policy.
libsndfile1 = "latest"

# bwfmetaedit: Download from MediaArea (not available in Ubuntu repos)
# Check https://mediaarea.net/BWFMetaEdit/Download/Ubuntu for available versions
bwfmetaedit = { source = "repos_or_mediaarea", pinned_version = "25.04.1" }

[macos]
# macOS packages are installed via Homebrew and verified against these versions.
# Homebrew does not support installing pinned versions (except ffmpeg@7), so we install the latest stable.
# When Homebrew updates package versions, the installation script's version check will fail.
# Update these versions to match Homebrew's latest stable versions when that happens.
# Note: mediainfo (media-info in Homebrew) cannot be pinned - Homebrew installs whatever version
# is currently in the formula. If CI fails with version mismatch, update this pinned version to
# match what Homebrew currently provides (check with: brew info media-info).
ffmpeg = "7"
flac = "1.5.0"
mediainfo = "25.10"
bwfmetaedit = "25.04.1"
id3v2 = "0.1.12"
exiftool = "13.36"
libsndfile = "1.2.2"

[windows]
# Windows package versions (install via Chocolatey)
# Format: Use --version flag: choco install package --version=1.2.3 (fails if not available, no fallback)
# To check available versions: choco search <package> --exact
# Note: Chocolatey version format example: "7.1.0" or "24.12"
# IMPORTANT: Verify these versions match what's available in the pinned Windows CI version:
#   Run in CI: choco search <package> --exact to see available versions
#   Update these pinned versions to match what CI actually installs
ffmpeg = "7.1.0"  # Pinned version (fails if not available) - VERIFY THIS VERSION
flac = "1.3.4"  # Pinned version (fails if not available) - VERIFY THIS VERSION
mediainfo = "24.12"  # Pinned version (fails if not available) - VERIFY THIS VERSION
# id3v2: Not available in Chocolatey. Installed via WSL (Windows Subsystem for Linux) using Ubuntu package.
# Uses Ubuntu version format since it's installed via WSL/Ubuntu apt-get.
id3v2 = "0.1.12+dfsg-7"  # Pinned version via WSL Ubuntu (same as Ubuntu CI) - VERIFY THIS VERSION

# bwfmetaedit: Download pinned version from MediaArea (not available in Chocolatey)
bwfmetaedit = { source = "mediaarea", pinned_version = "24.10" }

# exiftool: Download from official website (not available in Chocolatey)
# Note: Windows version may differ from macOS/Linux due to release availability
# Check https://exiftool.org/ for available Windows versions
# Pinned to latest available version (fetched from https://exiftool.org/ver.txt)
exiftool = { source = "exiftool_org", pinned_version = "13.41" }

[verification]
# Commands to verify tool installation and versions
# These are used by CI and can be run locally to verify setup
ubuntu = [
    "ffprobe -version",
    "flac --version",
    "metaflac --version || echo 'metaflac not found (should be bundled with flac)'",
    "mediainfo --version",
    "bwfmetaedit --version || echo 'bwfmetaedit not found'",
    "id3v2 --version || echo 'id3v2 not found'",
    "which mid3v2 && mid3v2 --version || echo 'mid3v2 not found (mutagen provides it, may not be in PATH)'",
    "exiftool -ver || echo 'exiftool not found'"
]

macos = [
    "ffprobe -version",
    "flac --version",
    "metaflac --version || echo 'metaflac not found (should be bundled with flac)'",
    "mediainfo --version",
    "bwfmetaedit --version || echo 'bwfmetaedit not found'",
    "id3v2 --version || echo 'id3v2 not found'",
    "which mid3v2 && mid3v2 --version || echo 'mid3v2 not found (mutagen provides it, may not be in PATH)'",
    "exiftool -ver || echo 'exiftool not found'"
]

windows = [
    "ffprobe -version",
    "flac --version",
    "metaflac --version",
    "mediainfo --version",
    "if (Get-Command bwfmetaedit -ErrorAction SilentlyContinue) { bwfmetaedit --version } else { Write-Host 'bwfmetaedit not found' }",
    "if (Get-Command id3v2 -ErrorAction SilentlyContinue) { id3v2 --version } else { Write-Host 'id3v2 not found' }",
    "if (Get-Command mid3v2 -ErrorAction SilentlyContinue) { mid3v2 --version } else { Write-Host 'mid3v2 not found (mutagen provides it, may not be in PATH)' }",
    "if (Get-Command exiftool -ErrorAction SilentlyContinue) { exiftool -ver } else { Write-Host 'exiftool not found' }"
]

